<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demand Rusher - Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #2c2f33;
            color: #dcdcdc;
        }
        .container-panel {
            background-color: #40444b;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-[#2c2f33] min-h-screen flex items-center justify-center">

    <div class="container-panel p-8 w-full max-w-lg space-y-6">
        <h1 class="text-3xl font-bold text-center text-[#7289da]">Demand Rusher</h1>
        <h2 id="form-title" class="text-xl font-semibold text-center">Login to your Account</h2>
        
        <form id="auth-form" class="space-y-4">
            <div>
                <label for="email" class="block text-sm font-medium mb-1">Email</label>
                <input type="email" id="email" required class="w-full p-3 bg-[#2f3136] rounded-md border border-[#52555a] focus:outline-none focus:ring-1 focus:ring-[#7289da]">
            </div>
            <div>
                <label for="password" class="block text-sm font-medium mb-1">Password</label>
                <input type="password" id="password" required class="w-full p-3 bg-[#2f3136] rounded-md border border-[#52555a] focus:outline-none focus:ring-1 focus:ring-[#7289da]">
            </div>
            <div id="password-confirm-group" class="hidden">
                <label for="password-confirm" class="block text-sm font-medium mb-1">Confirm Password</label>
                <input type="password" id="password-confirm" class="w-full p-3 bg-[#2f3136] rounded-md border border-[#52555a] focus:outline-none focus:ring-1 focus:ring-[#7289da]">
            </div>
            <div id="form-error" class="text-red-400 text-sm hidden"></div>
            <button type="submit" id="submit-btn" class="w-full bg-[#7289da] text-white font-bold py-3 rounded-md hover:bg-[#6273c5] transition duration-200">
                Login
            </button>
        </form>

        <div class="text-center text-sm">
            <p id="switch-auth">
                Don't have an account? <a href="#" class="text-[#7289da] hover:underline" id="signup-link">Sign Up</a>
            </p>
        </div>
    </div>

    <div id="modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex justify-center items-center p-4">
        <div class="bg-[#36393f] rounded-lg shadow-xl p-6 w-full max-w-sm">
            <h3 id="modal-title" class="text-lg font-bold mb-2 text-center"></h3>
            <p id="modal-message" class="text-gray-400 mb-4 text-center"></p>
            <div class="flex justify-end">
                <button id="modal-ok-btn" class="bg-[#7289da] text-white font-bold py-2 px-4 rounded-full hover:bg-[#6273c5] transition duration-200">OK</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        
        const firebaseConfig = {
          apiKey: "AIzaSyAReb65bsaoa145J5Yu2R61nrr4vvmqBiQ",
          authDomain: "demand-rusher.firebaseapp.com",
          projectId: "demand-rusher",
          storageBucket: "demand-rusher.firebasestorage.app",
          messagingSenderId: "491613307536",
          appId: "1:4913339b4f12ef7418ce15",
          measurementId: "G-VY4JSL70QV"
        };

        // DOM References
        const formTitle = document.getElementById('form-title');
        const authForm = document.getElementById('auth-form');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const passwordConfirmGroup = document.getElementById('password-confirm-group');
        const passwordConfirmInput = document.getElementById('password-confirm');
        const formError = document.getElementById('form-error');
        const submitBtn = document.getElementById('submit-btn');
        const switchAuthLink = document.getElementById('switch-auth');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalOkBtn = document.getElementById('modal-ok-btn');

        let isLogin = true;

        // Firebase Initialization
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // UI Functions
        function showModal(title, message) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modal.style.display = 'flex';
        }

        function hideModal() {
            modal.style.display = 'none';
        }

        function resetForm() {
            emailInput.value = '';
            passwordInput.value = '';
            passwordConfirmInput.value = '';
            formError.textContent = '';
            formError.classList.add('hidden');
        }

        // Event Listeners
        modalOkBtn.addEventListener('click', hideModal);

        switchAuthLink.addEventListener('click', (e) => {
            e.preventDefault();
            isLogin = !isLogin;
            resetForm();
            if (isLogin) {
                formTitle.textContent = 'Login to your Account';
                submitBtn.textContent = 'Login';
                passwordConfirmGroup.classList.add('hidden');
                switchAuthLink.innerHTML = "Don't have an account? <a href='#' class='text-[#7289da] hover:underline' id='signup-link'>Sign Up</a>";
            } else {
                formTitle.textContent = 'Create a New Account';
                submitBtn.textContent = 'Sign Up';
                passwordConfirmGroup.classList.remove('hidden');
                switchAuthLink.innerHTML = "Already have an account? <a href='#' class='text-[#7289da] hover:underline' id='login-link'>Login</a>";
            }
        });

        authForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = emailInput.value;
            const password = passwordInput.value;
            
            formError.classList.add('hidden');

            try {
                if (isLogin) {
                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    if (!userCredential.user.emailVerified) {
                        showModal('Action Required', 'Please verify your email address to log in.');
                    } else {
                        showModal('Success', 'Login successful! Redirecting...');
                        setTimeout(() => {
                            window.location.href = 'index.html';
                        }, 1500);
                    }
                } else {
                    const passwordConfirm = passwordConfirmInput.value;
                    if (password !== passwordConfirm) {
                        formError.textContent = 'Passwords do not match.';
                        formError.classList.remove('hidden');
                        return;
                    }
                    if (password.length < 6) {
                        formError.textContent = 'Password should be at least 6 characters.';
                        formError.classList.remove('hidden');
                        return;
                    }
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    await sendEmailVerification(userCredential.user);
                    showModal('Account Created!', 'A verification email has been sent to your address. Please check your inbox, **including your spam folder**, and log in after you verify your email.');
                }
            } catch (error) {
                let errorMessage;
                switch (error.code) {
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email address.';
                        break;
                    case 'auth/user-not-found':
                    case 'auth/wrong-password':
                        errorMessage = 'Invalid email or password.';
                        break;
                    case 'auth/email-already-in-use':
                        errorMessage = 'This email is already in use.';
                        break;
                    default:
                        errorMessage = 'An error occurred. Please try again.';
                        break;
                }
                formError.textContent = errorMessage;
                formError.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
