<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GameMaster Panel</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Inter', sans-serif;
    background-color: #2c2f33;
    color: #dcdcdc;
}
.container-panel {
    background-color: #40444b;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}
.input-field, select {
    width: 100%;
    padding: 0.5rem;
    border-radius: 6px;
    background-color: #2f3136;
    border: none;
    color: #dcdcdc;
}
.button {
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
}
.button:hover {
    opacity: 0.9;
}
.item-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem;
    border-bottom: 1px solid #36393f;
}
.item-row:last-child {
    border-bottom: none;
}
</style>
</head>
<body class="bg-[#2c2f33] min-h-screen flex flex-col items-center">

<div class="w-full max-w-4xl p-8 space-y-6">

<header class="flex justify-between items-center container-panel p-4">
<h1 class="text-3xl font-bold text-[#7289da]">GameMaster Panel</h1>
</header>

<div class="container-panel p-6 space-y-4">

<h2 class="text-xl font-bold mb-2">Create New Item</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<label for="item-name">Item Name</label>
<input type="text" id="item-name" class="input-field">
</div>
<div>
<label for="item-category">Category</label>
<input type="text" id="item-category" class="input-field" placeholder="Optional">
</div>
<div>
<label for="item-parent">Parent Item</label>
<select id="item-parent" class="input-field">
<option value="">-- No Parent --</option>
</select>
</div>
</div>
<button id="add-item-btn" class="button bg-[#7289da] text-white mt-4">Add Item</button>
<button id="create-premade-offers" class="button bg-green-500 text-white mt-4">Create Premade Offers ($1)</button>

<p id="item-message" class="mt-2 text-green-400"></p>

<h2 class="text-xl font-bold mt-6 mb-2">Items</h2>
<div class="flex mb-2 space-x-2">
<input type="text" id="search-item" placeholder="Search..." class="input-field flex-grow">
<select id="filter-category" class="input-field w-48">
<option value="">All Categories</option>
</select>
</div>

<div id="item-list" class="space-y-2 max-h-80 overflow-y-auto">
<!-- Items will be dynamically listed here -->
</div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyAReb65bsaoa145J5Yu2R61nrr4vvmqBiQ",
    authDomain: "demand-rusher.firebaseapp.com",
    projectId: "demand-rusher",
    storageBucket: "demand-rusher.firebasestorage.app",
    messagingSenderId: "491613307536",
    appId: "1:491613307536:web:52f3339b4f12ef7418ce15",
    measurementId: "G-VY4JSL70QV"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const addItemBtn = document.getElementById('add-item-btn');
const createPremadeBtn = document.getElementById('create-premade-offers');
const itemNameInput = document.getElementById('item-name');
const itemCategoryInput = document.getElementById('item-category');
const itemParentSelect = document.getElementById('item-parent');
const itemListDiv = document.getElementById('item-list');
const itemMessage = document.getElementById('item-message');
const searchInput = document.getElementById('search-item');
const filterCategory = document.getElementById('filter-category');

let itemsData = {};

async function loadItems() {
    const itemsSnapshot = await getDocs(collection(db, 'artifacts/demandrusher_1.0.0/items'));
    itemsData = {};
    itemParentSelect.innerHTML = `<option value="">-- No Parent --</option>`;
    filterCategory.innerHTML = `<option value="">All Categories</option>`;
    itemsSnapshot.forEach(docSnap => {
        const data = docSnap.data();
        itemsData[docSnap.id] = data;
        itemParentSelect.innerHTML += `<option value="${docSnap.id}">${data.name}</option>`;
        if(data.category && !Array.from(filterCategory.options).some(opt => opt.value === data.category)) {
            filterCategory.innerHTML += `<option value="${data.category}">${data.category}</option>`;
        }
    });
    renderItems();
}

function renderItems() {
    const search = searchInput.value.toLowerCase();
    const categoryFilter = filterCategory.value;
    itemListDiv.innerHTML = '';
    Object.keys(itemsData).forEach(id => {
        const item = itemsData[id];
        if(search && !item.name.toLowerCase().includes(search)) return;
        if(categoryFilter && item.category !== categoryFilter) return;
        const row = document.createElement('div');
        row.className = 'item-row';
        row.innerHTML = `<span>${item.name} ${item.parent ? `(Parent: ${itemsData[item.parent]?.name || 'N/A'})` : ''} [${item.category || 'No Category'}]</span>`;
        itemListDiv.appendChild(row);
    });
}

// Add new item
addItemBtn.addEventListener('click', async () => {
    const name = itemNameInput.value.trim();
    const category = itemCategoryInput.value.trim();
    const parent = itemParentSelect.value || null;

    if(!name) return alert("Item name is required");

    const newItem = { name, category, parent };
    await addDoc(collection(db, 'artifacts/demandrusher_1.0.0/items'), newItem);

    itemMessage.textContent = `Item "${name}" has been created!`;
    itemNameInput.value = '';
    itemCategoryInput.value = '';
    itemParentSelect.value = '';
    await loadItems();
});

// Create premade offers ($1)
createPremadeBtn.addEventListener('click', async () => {
    if(!confirm("Create unlimited $1 offers for all items?")) return;
    const itemsSnapshot = await getDocs(collection(db, 'artifacts/demandrusher_1.0.0/items'));
    itemsSnapshot.forEach(async docSnap => {
        const itemId = docSnap.id;
        const offer = {
            itemId,
            quantity: 9999,
            pricePerUnit: 1,
            type: 'sell',
            timestamp: Date.now(),
            sellerId: 'premade'
        };
        await addDoc(collection(db, 'artifacts/demandrusher_1.0.0/offers'), offer);
    });
    itemMessage.textContent = "Premade $1 offers have been created!";
});

// Search and filter
searchInput.addEventListener('input', renderItems);
filterCategory.addEventListener('change', renderItems);

// Initial load
loadItems();
</script>
</body>
</html>
